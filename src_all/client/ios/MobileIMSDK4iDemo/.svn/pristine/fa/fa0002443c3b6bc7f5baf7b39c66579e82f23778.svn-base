//
//  ProtocalQoS4ReciveProvider.h
//  RainbowCore4i
//
//  Created by JackJiang on 14/10/23.
//  Copyright (c) 2014年 cngeeker.com. All rights reserved.
//

/**
 * 本类用于QoS机制中用于登记已接收包的情况等.
 *
 * <p>
 * 本类存在的重要性在于：QoS机制中在防止因网络丢包导致对方未收到应答时而再次发送消息从而导致消息重复，
 * 本类中将存储一个时间段内收到的所有需要QoS支持的消息的指统列表.后台线程将每隔一时间清理已超期的消息，
 * 因为超期的消息则意味着对方要么已经收到应答包（这是QoS机制正常情况下的表现）无需再次重传、要么是已
 * 经达到QoS机制的重试极限而无可能再收到重复包（那么在本类列表中该表也就没有必要再记录了）.
 *
 * <p>
 * 目前QoS机制，支持C2C、C2S的质量保证机制，但尚不支持S2C的质量保证模式.
 *
 * @author Jack Jiang, 2014-10-23
 * @version 1.0
 */

#import <Foundation/Foundation.h>
#import "Protocal.h"
#import "CompletionDefine.h"

@interface ProtocalQoS4ReciveProvider : NSObject

// 获取本类的单例。使用单例访问本类的所有资源是唯一的合法途径。
+ (ProtocalQoS4ReciveProvider *)sharedInstance;

- (void) startup:(BOOL)immediately;

- (void) stop;

- (BOOL) isRunning;

- (void) addRecieved:(Protocal *)p;

- (void) addRecievedWithFingerPrint:(NSString *) fingerPrintOfProtocal;

/**
 * 指定指纹码的Protocal是否已经收到过.
 * <p>
 * 此方法用于QoS机制中在防止因网络丢包导致对方未收到应答时而再次发送消息从而导致消息重复时的判断依赖.
 *
 * @param fingerPrintOfProtocal
 * @return
 */
- (BOOL) hasRecieved:(NSString *) fingerPrintOfProtocal;

/**
 * 当前列表大小.
 *
 * @return
 * @see NSDictionaty -> count:
 */
- (unsigned long) size;

/*!
 *  @Author Jack Jiang, 14-11-07 22:11:28
 *
 *  Just for DEBUG.
 */
- (void) setDebugObserver:(ObserverCompletion)debugObserver;

@end
